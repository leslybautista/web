!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Democracy Storymap</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css" rel="stylesheet" />
  <script src="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6.5.0/turf.min.js"></script>
  <link rel="stylesheet" href="style.css">

  <style>
    html,
    body {
      margin: 0;
      padding: 0;
      font-family: "Helvetica Neue", sans-serif;
      height: 100%;
      color: #e7e7e7;

      overflow: hidden;
    }

    #map {
      position: fixed;
      top: 55px;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
    }

    .story-container {
      margin-top: 20px;
      position: relative;
      z-index: 2;
      height: 100%;
      width: 45%;
      max-width: 700px;
      background: rgba(0, 0, 0, 0.9);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      justify-content: center;
      padding: 2rem;
      box-shadow: 4px 0 12px rgba(0, 0, 0, 0.1);
    }

    .slide {
      display: none;
      flex-direction: column;
    }

    .slide.active {
      display: flex;
    }

    .slide h1 {
      margin-top: 0;
      font-size: 60px;
      color: #f1f1f1;
    }

    .slide h2 {
      margin-top: 0;
      font-size: 2rem;
      color: #f1f1f1;
    }

    .slide p {
      color: #f1f1f1;
      line-height: 1.6;
    }

    .legend {
      position: absolute;
      bottom: 20px;
      right: 20px;
      background: white;
      padding: 10px;
      font-size: 14px;
      border-radius: 5px;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.2);
      z-index: 3;
    }

    .legend-item {
      display: flex;
      align-items: center;
      margin-bottom: 4px;
      color: black;
      z-index: 5;
    }

    .color-box {
      width: 15px;
      height: 15px;
      margin-right: 8px;
      display: inline-block;
    }

    .liberal {
      background-color: #756e91;
    }

    .electoral-democracy {
      background-color: #b0b1cb;
    }

    .ed-lower-bound {
      background-color: #E4E1ED;
    }

    .ea-upper-bound {
      background-color: #D7BDA0;
    }

    .electoral-autocracy {
      background-color: #bd7262;
    }

    .closed-autocracy {
      background-color: #ac4f3b;
    }

    @media (max-width: 768px) {
      .story-container {
        width: 100%;
      }
    }
  </style>
</head>

<body>
  <nav class="navbar">
    <div class="nav-container">
      <a href="#" class="logo">Democratization vs. Autocratization</a>
      <ul class="nav-menu">
        <li><a href="index.html" class="nav-link">Home</a></li>
        <li><a href="overview.html" class="nav-link">Overview</a></li>
        <li><a href="europe.html" class="nav-link">Europe</a></li>
        <li><a href="north.html" class="nav-link active">North America</a></li>
        <li><a href="south.html" class="nav-link">South America</a></li>
        <li><a href="asia.html" class="nav-link">Asia</a></li>
        <li><a href="africa.html" class="nav-link">Africa</a></li>
        <li><a href="map.html" class="nav-link">Map</a></li>
      </ul>
      <button class="mobile-menu-toggle">☰</button>
    </div>
  </nav>

  <div id="map"></div>

  <div class="story-container" id="story">
    <div class="slide active" data-country="Global">
      <h2>North America</h2>
      <p>The state of democracy in North America, Central America, and the Caribbean is increasingly 
        defined by stark contrasts between democratic resilience and authoritarian resurgence. 
        While some nations maintain relatively stable democratic systems, others are experiencing deepening 
        political crises marked by the erosion of institutional checks, the weakening of electoral integrity, 
        and the concentration of power in the executive. Popular support for leaders who undermine democratic 
        norms remains a significant challenge, often driven by dissatisfaction with traditional political elites 
        and a desire for stability or reform. At the same time, civic activism, public engagement, and institutional 
        reforms in parts of the region offer signs of hope, demonstrating that democratic renewal is possible through engaged 
        citizenry and collective action. Overall, the region reflects a broader global trend in which
        democracy is neither assured nor uniformly practiced, but constantly contested and reshaped. </p>
    </div>
    <div class="slide active" data-country="El Salvador">
      <h2>El Salvador</h2>
      <h3>
        <a href="https://www.journalofdemocracy.org/articles/latin-america-erupts-millennial-authoritarianism-in-el-salvador/"
          target="_blank">
          Latin America Erupts: Millennial Authoritarianism in El Salvador </a>
      </h3>
      <p>
       Discusses President Nayib Bukele’s use of a legislative supermajority to dismiss the country’s 
       highest court and top prosecutor, deepening El Salvador’s 
       democratic crisis and highlighting a blend of populist and authoritarian tactics.
      </p>
      <br>
      <h3>
        <a href="https://www.researchgate.net/publication/363393850_Nayib_Bukele_populism_and_autocratization_or_a_very_popular_democratically_elected_president"
          target="_blank">
          Nayib Bukele: populism and autocratization, or a very popular democratically elected president?</a>
      </h3>
      <p>
      Analyzes Bukele’s presidency as a case of populism and autocratization, 
      noting actions that have contributed to democratic backsliding and the erosion of pluralism and civil society.
      </p>
    </div> 
    <div class="slide" data-country="Nicaragua">
      <h2>Nicaragua</h2>
      <h3>
        <a href="https://carnegieendowment.org/posts/2021/11/nicaraguas-farcical-election-marks-consolidation-of-ortegas-autocracy?lang=en"
        target="_blank">
          Nicaragua's Farcical Election Marks Consolidation of Ortega's Autocracy</a>
      </h3>
      <p>
        Details President Daniel Ortega’s consolidation of power, the suppression of opposition, and 
        the broader erosion of democracy in Nicaragua, setting a precedent for authoritarianism in the region.</p>
    </div>
    <div class="slide" data-country="Haiti">
      <h2>Haiti</h2>
      <h3>
        <a href="https://www.uusc.org/let-democracy-triumph-in-haiti/"
        target="_blank">
          Let Democracy Triumph in Haiti</a>
      </h3>
      <p>
        Examines the autocratic tendencies of Haiti’s leadership following the assassination of President Jovenel Moïse, 
        the unelected status of Prime Minister Ariel Henry, and the ongoing suppression of democratic processes and civil society.
      </p>
    </div>
    <div class="slide" data-country="Mexico">
      <h2>Mexico</h2>
      <h3>
        <a href="https://www.brookings.edu/articles/mexico-takes-another-step-toward-its-authoritarian-past/"
        target="_blank">
          Mexico takes another step toward its authoritarian past</a>
      </h3>
      <p>
        Analyzes President López Obrador’s efforts to undermine independent electoral institutions,
        centralize power, and erode checks and balances, raising concerns about a return to authoritarian practices in Mexico.
      </p>
    </div>
    <div class="slide" data-country="Honduras">
      <h2>Honduras</h2>
      <h3>
        <a href="https://progressive.international/observatory/2021-11-30-honduras-rises-up-to-reclaim-its-democracy/en"
        target="_blank">
          Honduras rises up to reclaim its democracy</a>
      </h3>
      <p>
        Covers the 2021 election of Xiomara Castro, highlighting how Hondurans overcame political violence, disinformation, 
        and attempts at voter suppression to achieve a peaceful democratic transition after years of instability since the 2009 coup.
      </p>
      <br>
      <h3>
        <a href="https://www.hnn.us/article/a-chance-for-real-democracy-in-honduras"
        target="_blank">
          A Chance for Real Democracy in Honduras</a>
      </h3>
      <p>
        Explores the historical context of democracy in Honduras, noting the shift from externally imposed democracy to 
        increased citizen participation and the significance of recent elections for democratic renewal.
      </p>
    </div>
    <div class="slide" data-country="Dominican Republic">
      <h2>Dominican Republic</h2>
      <h3>
        <a href="https://www.idea.int/blog/explainer-challenges-and-opportunities-dominican-republic-era-luis-abinader"
        target="_blank">
          Explainer: Challenges and Opportunities for the Dominican Republic in the Era of Luis Abinader</a>
      </h3>
      <p>
        Analyzes recent improvements in democratic participation, rule of law, and government accountability, 
        and highlights the country as a positive exception in a region experiencing democratic decline. It also 
        discusses ongoing reforms and the role of civil society in defending democratic norms.
      </p>
      <br>
      <h3>
        <a href="https://nvdatabase.swarthmore.edu/node/5063"
        target="_blank">
          Dominicans protest suspended elections to defend democracy, 2020</a>
      </h3>
      <p>
        Details the mass protests following the suspension of municipal elections in 2020, emphasizing how 
        citizen activism and demands for accountability led to electoral reforms and increased transparency in subsequent elections.
      </p>
    </div>
  </div>
  <div class="legend">
    <div class="legend-item"><span class="color-box liberal"></span> Liberal democracy</div>
    <div class="legend-item"><span class="color-box electoral-democracy"></span> Electoral democracy</div>
    <div class="legend-item"><span class="color-box ed-lower-bound"></span> Electoral dem. Lower Bound</div>
    <div class="legend-item"><span class="color-box ea-upper-bound"></span> Electoral Aut. Upper Bound</div>
    <div class="legend-item"><span class="color-box electoral-autocracy"></span> Electoral autocracy</div>
    <div class="legend-item"><span class="color-box closed-autocracy"></span> Closed autocracy</div>
  </div>
  
  <script>
  const map = new maplibregl.Map({
    container: 'map',
    style: {
      version: 8,
      sources: {
        'raster-tiles': {
          type: 'raster',
          tiles: [
            'https://a.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png'],
          tileSize: 256,
          attribution: '© OpenStreetMap contributors, © CartoDB'
        }
      },
      layers: [
        {
          id: 'simple-tiles',
          type: 'raster',
          source: 'raster-tiles',
          minzoom: 0,
          maxzoom: 22
        }
      ]
    },
    center: [-95, 20],    // center on North America
    zoom: 2.5              // zoom level showi N America nicely
  });
  const northAmericaBBox = [-130, 0, -50, 50]; // [west, south, east, north]


  // Add zoom and rotation controls to the map.
  map.addControl(new maplibregl.NavigationControl({
    visualizePitch: true,
    visualizeRoll: true,
    showZoom: true,
    showCompass: true
  }));

  let geoData = null;
  let currentIndex = 0;
  const slides = document.querySelectorAll('.slide');

  map.on('load', () => {
    fetch('data/democracy.geojson')
      .then(res => res.json())
      .then(data => {
        geoData = data;

        map.addSource('democracy', {
          type: 'geojson',
          data: geoData
        });

        map.addLayer({
          id: 'country-fill',
          type: 'fill',
          source: 'democracy',
          paint: {
            'fill-color': [
              'match', ['get', 'Democracy_'],
              'LD', '#756e91',
              'LD-', '#756e91',
              'ED', '#b0b1cb',
              'ED+', '#b0b1cb',
              'ED-', '#E4E1ED',
              'EA+', '#D7BDA0',
              'EA', '#bd7262',
              'CA', '#ac4f3b',
              '#cccccc'
            ],
            'fill-opacity': 0.9
          }
        });

        map.addLayer({
          id: 'country-border',
          type: 'line',
          source: 'democracy',
          paint: {
            'line-color': '#555',
            'line-width': 1
          }
        });

        map.addLayer({
          id: 'highlight',
          type: 'line',
          source: 'democracy',
          paint: {
            'line-color': '#000000',
            'line-width': 4
          },
          filter: ['==', 'COUNTRY', '']
        });

        updateSlide(0);
      });
  });


  function updateSlide(index) {
    if (!geoData || index < 0 || index >= slides.length) return;

    slides.forEach((slide, i) => {
      slide.classList.toggle('active', i === index);
    });

    const country = slides[index].dataset.country;
    currentIndex = index;

    // If it's the "Global" slide, show South America bounding box & clear highlight
    if (country === "Global") {
      const northAmericaBBox = [-130, 0, -50, 50];
      const containerWidth = document.getElementById('story').clientWidth;
      const offsetX = containerWidth / 4;
      const offsetY = 0;

      map.setFilter('highlight', ['==', 'COUNTRY', '']); // clear highlight

      map.fitBounds(northAmericaBBox, {
        padding: 100,
        duration: 1200,
        offset: [offsetX, offsetY]
      });
      return;
    }

    // For other countries: highlight and zoom to the country polygon
    map.setFilter('highlight', ['==', 'COUNTRY', country]);

    const feature = geoData.features.find(f => f.properties.COUNTRY === country);
    if (!feature || !feature.geometry) {
      console.warn("Country not found in geoData:", country);
      return;
    }

    try {
      const bbox = turf.bbox(feature);

      const containerWidth = document.getElementById('story').clientWidth;
      const offsetX = containerWidth / 4;
      const offsetY = 0;

      map.fitBounds(bbox, {
        padding: 100,
        duration: 1200,
        offset: [offsetX, offsetY]
      });
    } catch (err) {
      console.warn('Could not fly to', country, err);
    }
  }


  document.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowDown') {
      e.preventDefault();
      updateSlide(currentIndex + 1);
    } else if (e.key === 'ArrowUp') {
      e.preventDefault();
      updateSlide(currentIndex - 1);
    }
  });
</script>
</body>

</html>
